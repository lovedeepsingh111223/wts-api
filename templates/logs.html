{% extends "layout.html" %}

{% block content %}
<div class="p-6 md:p-10 bg-gray-100 min-h-[75vh] -m-6 md:-m-8">
    <div class="flex items-center justify-between mb-6">
        <h1 class="text-3xl font-bold text-gray-800">System Logs</h1>
        <div class="flex items-center gap-4">
            <button class="text-blue-600 hover:underline text-sm font-semibold" onclick="location.reload()">Refresh</button>
            <button class="text-gray-600 hover:text-red-600 text-sm font-semibold" id="clear-logs-btn">Clear All</button>
        </div>
    </div>
    <div class="bg-white p-4 rounded-xl shadow-md mb-6 flex items-center justify-between gap-4">
        <div class="relative flex-1">
            <svg class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
            </svg>
            <input type="text" placeholder="Search logs..." class="w-full pl-10 pr-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500" id="log-search-input">
        </div>
        <div class="flex items-center gap-2 text-sm text-gray-600">
            <p>Filter by:</p>
            <select class="p-2 rounded-lg border border-gray-300 bg-white focus:outline-none" id="log-filter-select">
                <option value="All">All</option>
                <option value="INFO">INFO</option>
                <option value="WARNING">WARNING</option>
                <option value="ERROR">ERROR</option>
            </select>
        </div>
    </div>
    <div class="bg-white p-6 rounded-2xl shadow-xl space-y-4 max-h-[60vh] overflow-y-auto">
        {% if logs %}
            {% for log in logs %}
            <div class="flex items-start gap-4 p-4 rounded-lg bg-gray-50 border border-gray-200">
                {% if log.type == 'INFO' %}
                    <div class="bg-green-100 text-green-800 text-xs font-semibold px-2 py-1 rounded-full flex-shrink-0 mt-1">INFO</div>
                {% elif log.type == 'WARNING' %}
                    <div class="bg-yellow-100 text-yellow-800 text-xs font-semibold px-2 py-1 rounded-full flex-shrink-0 mt-1">WARNING</div>
                {% elif log.type == 'ERROR' %}
                    <div class="bg-red-100 text-red-800 text-xs font-semibold px-2 py-1 rounded-full flex-shrink-0 mt-1">ERROR</div>
                {% endif %}
                <div class="flex-1">
                    <p class="text-sm text-gray-500 font-mono mb-1">{{ log.timestamp }}</p>
                    <p class="text-gray-800 text-sm">{{ log.message }}</p>
                </div>
            </div>
            {% endfor %}
        {% else %}
            <p class="text-gray-500 text-center py-10">No logs found. Check your backend configuration or if the log file exists.</p>
        {% endif %}
    </div>
</div>

<script>
    const logSearchInput = document.getElementById('log-search-input');
    const logFilterSelect = document.getElementById('log-filter-select');
    const logEntries = Array.from(document.querySelectorAll('.bg-gray-50'));

    function filterLogs() {
        const searchText = logSearchInput.value.toLowerCase();
        const filterType = logFilterSelect.value;

        logEntries.forEach(entry => {
            const entryText = entry.textContent.toLowerCase();
            const entryType = entry.querySelector('div:first-child').textContent.trim();

            const matchesSearch = entryText.includes(searchText);
            const matchesType = filterType === 'All' || entryType === filterType;

            if (matchesSearch && matchesType) {
                entry.style.display = '';
            } else {
                entry.style.display = 'none';
            }
        });
    }

    logSearchInput.addEventListener('keyup', filterLogs);
    logFilterSelect.addEventListener('change', filterLogs);

    // Add functionality to clear logs
    const clearLogsBtn = document.getElementById('clear-logs-btn');
    clearLogsBtn.addEventListener('click', async () => {
        if (confirm('Are you sure you want to clear all logs? This action cannot be undone.')) {
            try {
                const response = await fetch('/clear-logs', { method: 'POST' });
                if (response.ok) {
                    alert('Logs cleared successfully!');
                    location.reload(); 
                } else {
                    alert('Failed to clear logs.');
                }
            } catch (error) {
                console.error('Error clearing logs:', error);
                alert('An error occurred while clearing logs.');
            }
        }
    });

    // Initial filter on page load
    filterLogs();
</script>
{% endblock %}